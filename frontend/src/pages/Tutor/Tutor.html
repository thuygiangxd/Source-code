<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trang Gia s∆∞ ‚Äì Tutor</title>
  <link rel="stylesheet" href="./Tutor.css" />

</head>
<body>
  <header class="site-header">
    <div class="header-inner">
      <a class="brand" href="#">
        <img class="brand-logo" src="../../assets/images/Logo_Group.png" alt="G&3N Logo" />
        <span>GIASUNO1</span>
      </a>

      <nav>
        <div class="nav">
          <a href="#home">Trang ch·ªß</a>
          <a href="#schedule">L·ªãch d·∫°y</a>
          <a href="#profile">H·ªì s∆°</a>
          <a href="#requests">N·ªôp ƒë∆°n</a>
        </div>
      </nav>

      <!-- Menu t√†i kho·∫£n HR -->
      <details class="user-mini" aria-label="T√πy ch·ªçn t√†i kho·∫£n">
        <summary class="avatar-btn" aria-haspopup="menu" aria-expanded="false">
          <div class="avatar" id="avatar">GS</div>
          <div class="u-meta">
            <div class="nm" id="hrName">Gia s∆∞</div>
            <div class="uid">To√°n</div>
          </div>
          <svg class="chev" width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </summary>

        <div class="user-popover" role="menu">
          <a role="menuitem" href="#profile" class="mi">
            <svg class="mi-ico" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.24-8 5v1h16v-1c0-2.76-3.6-5-8-5Z" fill="currentColor"/>
            </svg>
            Qu·∫£n l√Ω t√†i kho·∫£n
          </a>

          <a role="menuitem" href="#change-pass" class="mi">
            <svg class="mi-ico" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M17 8V6a5 5 0 0 0-10 0v2H5a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2h-2Zm-8 0V6a3 3 0 0 1 6 0v2H9Z" fill="currentColor"/>
            </svg>
            ƒê·ªïi m·∫≠t kh·∫©u
          </a>

          <a role="menuitem" href="#support" class="mi">
            <svg class="mi-ico" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 2a10 10 0 1 0 6.32 17.94L22 22l-2.06-3.68A10 10 0 0 0 12 2Zm1 15h-2v-2h2v2Zm2.07-7.75-.9.92A3.5 3.5 0 0 0 13.5 12h-2v-.5c0-.83.67-1.5 1.5-1.5a1.5 1.5 0 1 0-1.5-1.5H9a3 3 0 1 1 6 0c0 .66-.26 1.3-.93 2.25Z" fill="currentColor"/>
            </svg>
            Trung t√¢m h·ªó tr·ª£
          </a>

          <hr class="menu-divider" />

          <button role="menuitem" type="button" class="mi link-danger" id="btnLogout">
            <svg class="mi-ico" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M10 17v2H4a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6v2H5v10h5Zm9.59-5-3-3L17 7l5 5-5 5-1.41-2 3-3H11v-2h8.59Z" fill="currentColor"/>
            </svg>
            ƒêƒÉng xu·∫•t
          </button>
        </div>
      </details>
    </div>
  </header>

  <div class="shell">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="user-mini" style="margin-bottom:8px">
        <div class="avatar" id="avatar2">GS</div>
        <div>
          <div class="nm" id="tutorName2">Gia S∆∞</div>
          <div class="uid" id="tutorRank">H·∫°ng: Gold</div>
        </div>
      </div>
      <nav class="side-nav">
        <a class="side-link is-active" href="#home">
          <svg viewBox="0 0 24 24"><path d="M4 10L12 4l8 6v8a2 2 0 0 1-2 2h-4v-6H10v6H6a2 2 0 0 1-2-2z" fill="currentColor"/></svg>Trang ch·ªß
        </a>

        <a class="side-link" href="#dashboard">
          <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" fill="currentColor"/></svg>Dashboard
        </a>
        <a class="side-link" href="#schedule">
          <svg viewBox="0 0 24 24"><path d="M7 2v2H5a2 2 0 0 0-2 2v2h18V6a2 2 0 0 0-2-2h-2V2h-2v2H9V2H7zm14 8H3v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V10z" fill="currentColor"/></svg>L·ªãch d·∫°y
        </a>

        <a class="side-link" href="#teaching-courses">
          <svg viewBox="0 0 24 24"><path d="M4 19h16V5H4v14Zm2-2V7h12v10H6Zm3-2h6v-2H9v2Z" fill="currentColor"/></svg>Kh√≥a ƒëang d·∫°y
        </a>

        <a class="side-link" href="#register-classes">
          <svg viewBox="0 0 24 24"><path d="M12 2 1 7l11 5 9-4.09V17h2V7L12 2Z" fill="currentColor"/></svg>ƒêƒÉng k√Ω l·ªõp
        </a>
        <a class="side-link" href="#payroll">
          <svg viewBox="0 0 24 24"><path d="M4 6h16a2 2 0 0 1 2 2v8H2V8a2 2 0 0 1 2-2Zm0 12h16v2H4v-2Zm8-9a3 3 0 1 0 0 6 3 3 0 0 0 0-6Z" fill="currentColor"/></svg>Nh·∫≠n l∆∞∆°ng
        </a>
        <a class="side-link" href="#profile">
          <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.24-8 5v1h16v-1c0-2.76-3.6-5-8-5Z" fill="currentColor"/></svg>H·ªì s∆° gia s∆∞
        </a>
        <a class="side-link" href="#requests">
          <svg viewBox="0 0 24 24"><path d="M4 4h16v2H4zm0 7h16v2H4zm0 7h16v2H4z" fill="currentColor"/></svg>N·ªôp ƒë∆°n
        </a>
      </nav>
    </aside>

    <!-- N·ªôi dung -->
    <main class="content-area">
      <!-- Trang ch·ªß -->
      <section id="home" class="content-section active">
        <h2>üè† Trang ch·ªß</h2>
        <p>Ch√†o m·ª´ng quay l·∫°i, <strong id="helloName">Gia S∆∞</strong>! ƒê√¢y l√† b·∫£ng ƒëi·ªÅu khi·ªÉn d√†nh cho gia s∆∞.</p>
        <div class="stats-grid">
          <div class="stat-card"><h4>L·ªõp ƒëang d·∫°y</h4><p class="big" id="statTeaching">0</p></div>
          <div class="stat-card"><h4>Gi·ªù ƒë√£ d·∫°y (th√°ng n√†y)</h4><p class="big" id="statHours">0h</p></div>
          <div class="stat-card"><h4>L∆∞∆°ng t·∫°m t√≠nh</h4><p class="big" id="statSalary">0‚Ç´</p></div>
        </div>
        <div class="notice">
          <h4>Th√¥ng b√°o</h4>
          <ul id="notices">
            <li>üìÖ L·ªãch d·∫°y tu·∫ßn ƒë√£ c·∫≠p nh·∫≠t.</li>
            <li>üì• C√≥ 2 b√†i n·ªôp m·ªõi ƒëang ch·ªù ch·∫•m.</li>
            <li>üí≥ K·ª≥ l∆∞∆°ng th√°ng n√†y s·∫Ω kh√≥a v√†o ng√†y 28.</li>
          </ul>
        </div>
      </section>

      <!-- Dashboard -->
      <section id="dashboard" class="content-section">
        <h2>üìä Dashboard</h2>
        <div class="grid3">
          <!-- <div class="card soft">
            <div class="hstack"><span class="status-dot dot-blue"></span><strong>L·ªõp ch·ªù duy·ªát</strong></div>
            <div class="big" id="statPending" style="font-size:24px;font-weight:700;margin-top:6px">0</div>
            <div class="uid">C√°c y√™u c·∫ßu ƒëƒÉng k√Ω l·ªõp ƒëang ƒë·ª£i trung t√¢m ph√™ duy·ªát</div>
          </div> -->
          <div class="card soft">
            <div class="hstack"><span class="status-dot dot-amber"></span><strong>B√†i ch·∫•m</strong></div>
            <div class="big" id="statGrading" style="font-size:24px;font-weight:700;margin-top:6px">0</div>
            <div class="uid">B√†i t·∫≠p c·∫ßn ch·∫•m v√† nh·∫≠n x√©t</div>
          </div>
          <div class="card soft">
            <div class="hstack"><span class="status-dot dot-green"></span><strong>Ch·∫•m c√¥ng</strong></div>
            <div class="big" id="statSessions" style="font-size:24px;font-weight:700;margin-top:6px">0 bu·ªïi</div>
            <div class="uid">T·ªïng s·ªë ca ƒë√£ ch·∫•m c√¥ng trong th√°ng</div>
          </div>
        </div>
      </section>

      <!-- L·ªãch d·∫°y -->
      <section id="schedule" class="content-section">
        <h2>üóìÔ∏è L·ªãch d·∫°y</h2>
        <table class="table" id="tblSchedule" style="margin-top:10px">
          <thead><tr><th>Ng√†y</th><th>Gi·ªù</th><th>L·ªõp</th><th>Ghi ch√∫</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </section>

        <!-- Kh√≥a ƒëang d·∫°y -->
      <section id="teaching-courses" class="content-section">
        <h2>üìö Danh s√°ch kh√≥a h·ªçc ƒëang d·∫°y</h2>
        <div id="teachingList" class="grid2"></div>
      </section>



      <!-- ƒêƒÉng k√Ω l·ªõp (ch∆∞a nh·∫≠n) -->
      <section id="register-classes" class="content-section">
        <h2>üìù ƒêƒÉng k√Ω l·ªõp d·∫°y (l·ªõp ch∆∞a nh·∫≠n)</h2>
        <div class="hstack" style="flex-wrap:wrap;margin-bottom:10px">
          <input class="search" style="flex:1" placeholder="T√¨m theo m√¥n/l·ªõp/khu v·ª±c..." oninput="filterOpen(this.value)" />
          <button class="btn btn-ghost" onclick="renderOpenClasses()">T·∫£i l·∫°i</button>
        </div>
        <div id="openClassList" class="grid2"></div>
      </section>

      <!-- Ch·∫•m c√¥ng -->
      <section id="timesheet" class="content-section">
        <h2>‚è±Ô∏è Ch·∫•m c√¥ng</h2>
        <p class="uid">Ch·∫•m c√¥ng</p>
        <table class="table" id="tblTimesheet">
          <thead>
            <tr><th>Gi·ªù</th><th>L·ªõp</th><th>H√¨nh th·ª©c</th><th>Ghi ch√∫</th><th>H√†nh ƒë·ªông</th><th></th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>


      <!-- Nh·∫≠n l∆∞∆°ng -->
      <section id="payroll" class="content-section">
        <h2>üí≥ Nh·∫≠n l∆∞∆°ng</h2>
        <div class="hstack" style="flex-wrap:wrap">
          <label class="pill-btn">Th√°ng
            <input type="month" id="payMonth" style="border:0;margin-left:6px" onchange="renderPayroll()" />
          </label>
          <button class="btn btn-ghost" id="btnPayout" onclick="requestPayout()">Y√™u c·∫ßu thanh to√°n</button>
        </div>
        <table class="table" id="tblPayroll" style="margin-top:10px">
          <thead><tr><th>L·ªõp</th><th>Gi·ªù</th><th>ƒê∆°n gi√° (‚Ç´/h)</th><th>Th√†nh ti·ªÅn</th></tr></thead>
          <tbody></tbody>
          <tfoot><tr><td colspan="3">T·ªïng</td><td id="payTotal">0‚Ç´</td></tr></tfoot>
        </table>
        <p class="uid">L∆∞∆°ng t·∫°m t√≠nh d·ª±a tr√™n b·∫£ng ch·∫•m c√¥ng ƒë√£ ghi nh·∫≠n.</p>
      </section>

      <!-- H·ªì s∆° gia s∆∞ -->
      <section id="profile" class="content-section">
        <h2>üë§ Th√¥ng tin gia s∆∞</h2>
        <div class="grid2">
          <div class="card soft">
            <div class="stack">
              <label class="field">H·ªç t√™n<input id="pfName" type="text" placeholder="H·ªç t√™n"/></label>
              <label class="field">Email<input id="pfEmail" type="text" placeholder="Email"/></label>
              <label class="field">SƒêT<input id="pfPhone" type="tel" placeholder="S·ªë ƒëi·ªán tho·∫°i"/></label>
              <label class="field">Chuy√™n m√¥n<input id="pfMajor" type="text" placeholder="VD: To√°n, L√Ω, H√≥a"/></label>
              <label class="field">C·∫•p ƒë·ªô<input id="pfLevel" type="text" placeholder="VD: THCS, THPT"/></label>
              <label class="field">Gi·ªõi thi·ªáu<textarea id="pfBio" rows="4" placeholder="ƒê√¥i l·ªùi gi·ªõi thi·ªáu..."></textarea></label>
              <div class="hstack" style="flex-wrap:wrap">
                <button class="btn btn-primary" onclick="saveProfile()">L∆∞u h·ªì s∆°</button>
                <button class="btn btn-ghost" onclick="loadProfile()">T·∫£i l·∫°i</button>
              </div>
            </div>
          </div>
          <div class="card soft">
            <strong>H·ªì s∆° c√¥ng khai</strong>
            <p class="uid">H·ªçc vi√™n/Ph·ª• huynh nh√¨n th·∫•y:</p>
            <ul>
              <li>T√™n: <span id="pubName">‚Äî</span></li>
              <li>Chuy√™n m√¥n: <span id="pubMajor">‚Äî</span></li>
              <li>C·∫•p ƒë·ªô: <span id="pubLevel">‚Äî</span></li>
              <li>Gi·ªõi thi·ªáu: <span id="pubBio">‚Äî</span></li>
            </ul>
          </div>
        </div>
      </section>

      <!-- N·ªôp ƒë∆°n -->
      <section id="requests" class="content-section">
        <h2>üìÆ N·ªôp ƒë∆°n</h2>
        <div class="grid2">
          <div class="card soft">
            <div class="stack">
              <label class="field">Lo·∫°i ƒë∆°n
                <select id="rqType">
                  <option value="change">Xin ƒë·ªïi l·ªãch d·∫°y</option>
                  <option value="leave">Xin ngh·ªâ d·∫°y t·∫°m th·ªùi</option>
                  <option value="resign">Ngh·ªâ vi·ªác</option>
                </select>
              </label>
              <label class="field">√Åp d·ª•ng cho l·ªõp
                <select id="rqCourse"></select>
              </label>
              <div class="grid2">
                <label class="field">T·ª´ ng√†y<input id="rqFrom" type="date" /></label>
                <label class="field">ƒê·∫øn ng√†y<input id="rqTo" type="date" /></label>
              </div>
              <label class="field">L√Ω do<textarea id="rqReason" rows="4" placeholder="Tr√¨nh b√†y l√Ω do..."></textarea></label>
              <div class="hstack" style="flex-wrap:wrap">
                <button class="btn btn-primary" onclick="submitRequest()">G·ª≠i ƒë∆°n</button>
                <button class="btn btn-ghost" onclick="clearRequestForm()">X√≥a</button>
              </div>
            </div>
          </div>
          <div class="card soft">
            <strong>ƒê∆°n ƒë√£ g·ª≠i</strong>
            <div id="rqList" class="stack" style="margin-top:8px"></div>
          </div>
        </div>
      </section>
    </main>
  </div>





  <footer class="footer">
    <p>Copyright ¬© 2025 Online Tutor. Developed by <button class="invisible-btn">Group 09, TDTU</button>.</p>
  </footer>

  <script>
    // ================== STATE & DEMO DATA ==================
    const LS_KEY = 'tutorApp.v1';
    const money = n => (n||0).toLocaleString('vi-VN') + '‚Ç´';

    const DefaultApp = {
      profile: { name: 'Gia S∆∞', email: 'tutor@example.com', phone: '0901234567', major: 'To√°n', level: 'THPT', bio: '5 nƒÉm kinh nghi·ªám luy·ªán thi THPTQG.' },
   
    openClasses: [
        { id: 'O301', name: 'H√≥a 12 Luy·ªán ƒë·ªÅ', schedule: 'T3-T5 19:00-20:30', status: 'open' },
        { id: 'O302', name: 'To√°n 9 B·ªï tr·ª£', schedule: 'T2-T6 10:10-11:30', status: 'open' },
        { id: 'O303', name: 'Ti·∫øng Anh 6 Giao ti·∫øp', schedule: 'T4 20:00-21:30', status: 'open' }
    ],

    pending: [],

    schedule: [
        { date: '2025-11-04', time: '10:10-11:30', courseId: 'C202', note: 'Demo ch·∫•m c√¥ng 10:10' },
        { date: '2025-11-04', time: '19:00-20:30', courseId: 'C101', note: '' },
        { date: '2025-11-06', time: '10:10-11:30', courseId: 'C202', note: 'Ph√≤ng B203' }
    ],

    timesheet: [
        { date: '2025-11-03', courseId: 'C101', start: '19:00', end: '20:30', hours: 1.5 },
        { date: '2025-11-01', courseId: 'C202', start: '17:00', end: '18:30', hours: 1.5 }
    ],

    requests: []
    };

    function load(){
      const raw = localStorage.getItem(LS_KEY);
      if(raw){ try { return JSON.parse(raw); } catch(e){ console.warn(e) } }
      return DefaultApp;
    }
    function save(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }
    let state = load();


    // ================== NAV & INIT ==================
    const sideLinks = document.querySelectorAll('.side-nav .side-link');
    const sections = document.querySelectorAll('.content-section');
    sideLinks.forEach(a=>a.addEventListener('click', e=>{
      e.preventDefault();
      sideLinks.forEach(x=>x.classList.remove('is-active'));
      a.classList.add('is-active');
      const id = a.getAttribute('href').replace('#','');
      sections.forEach(s=>s.classList.remove('active'));
      document.getElementById(id)?.classList.add('active');
      // Lazy render per tab
      if(id==='register-classes') { renderOpenClasses(); }
      if(id==='schedule') renderSchedule();
      if(id==='payroll') renderPayroll();
      if(id==='profile') loadProfile();
      if(id==='requests') { fillRqCourses(); renderRequests(); }
      if(id==='dashboard') refreshStats();
      if(id==='home') refreshHome();
    }));

    // Header quick nav
    document.querySelectorAll('.nav a').forEach(a=>a.addEventListener('click',e=>{
      e.preventDefault();
      const target = a.getAttribute('href');
      const side = Array.from(sideLinks).find(x=>x.getAttribute('href')===target);
      side?.click();
    }));

    // ================== HOME & DASHBOARD ==================
    function initials(name){
      if(!name) return 'GS';
      const parts = name.trim().split(/\s+/);
      return ((parts[0]?.[0]||'G') + (parts.slice(-1)[0]?.[0]||'S')).toUpperCase();
    }
    function totalHoursInMonth(yyyymm){
      const [y,m] = yyyymm.split('-').map(Number);
      return state.timesheet.filter(r=>{
        const d = new Date(r.date); return d.getFullYear()===y && (d.getMonth()+1)===m && r.hours>0;
      }).reduce((a,b)=>a+b.hours,0);
    }
    function salaryInMonth(yyyymm){
      const [y,m]=yyyymm.split('-').map(Number);
      let total=0;
      // Removed teaching data dependency
      return total;
    }
    function refreshHome(){
      document.getElementById('helloName').textContent = state.profile.name || 'Gia s∆∞';
      // document.getElementById('statTeaching').textContent = 0;
      const ym = new Date().toISOString().slice(0,7);
      document.getElementById('statHours').textContent = (totalHoursInMonth(ym)).toFixed(1)+'h';
      document.getElementById('statSalary').textContent = money(salaryInMonth(ym));
    }
    function refreshStats(){
      // document.getElementById('statPending').textContent = 0;
      // const grading = 0;
      // document.getElementById('statGrading').textContent = grading;
      const ym = new Date().toISOString().slice(0,7);
      const sessions = state.timesheet.filter(r=> r.hours>0 && r.date.startsWith(ym)).length;
      document.getElementById('statSessions').textContent = sessions+ ' bu·ªïi';
    }


    // ================== OPEN CLASSES (REGISTER) ==================

        function renderOpenClasses(list) {
        const wrap = document.getElementById('openClassList');
        wrap.innerHTML = '';

        (list || state.openClasses)
            .filter(c => c.status === 'open')
            .forEach(c => {
            const el = document.createElement('div');
            el.className = 'course-card';
            el.innerHTML = `
                <div class="course-head">
                <div>
                    <strong>${c.name}</strong>
                    <div class="uid">L·ªãch h·ªçc: ${c.schedule}</div>
                </div>
                </div>
                <div class="course-actions">
                <button class="btn btn-primary" onclick="applyClass('${c.id}')">ƒêƒÉng k√Ω</button>
                <button class="btn btn-ghost" onclick="cancelClass('${c.id}')">H·ªßy ƒëƒÉng k√Ω</button>
                </div>`;
            wrap.appendChild(el);
            });
        }

        function applyClass(id) {
        const c = state.openClasses.find(x => x.id === id);
        if (!c) return;

        alert(`‚úÖ ƒê√£ g·ª≠i ƒëƒÉng k√Ω l·ªõp ${c.name}. Vui l√≤ng ch·ªù x√°c nh·∫≠n.`);
        }

        function cancelClass(id) {
        const c = state.openClasses.find(x => x.id === id);
        if (!c) return;

        if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy ƒëƒÉng k√Ω l·ªõp ${c.name}?`)) {
            alert(`‚ùå ƒê√£ h·ªßy ƒëƒÉng k√Ω l·ªõp ${c.name}.`);
        }
        }

        function filterOpen(q) {
        q = (q || '').trim().toLowerCase();
        if (!q) {
            renderOpenClasses();
            return;
        }
        const list = state.openClasses.filter(
            c =>
            (c.name + ' ' + c.area + ' ' + c.schedule)
                .toLowerCase()
                .includes(q) && c.status === 'open'
        );
        renderOpenClasses(list);
        }

      // ================== PAYROLL ==================
      function renderPayroll(){
        const month = document.getElementById('payMonth')?.value || new Date().toISOString().slice(0,7);
        const tb = document.querySelector('#tblPayroll tbody');
        const btn = document.getElementById('btnPayout');
        const note = document.getElementById('payNote');
        if (!tb) return;
        tb.innerHTML='';

        let total = 0;
        let rows = 0;

        // No mock data

        // T·ªïng
        const payTotalEl = document.getElementById('payTotal');
        if (payTotalEl) {
          payTotalEl.textContent = money(total);
        }

        if(rows === 0){
          // Kh√¥ng c√≥ d·ªØ li·ªáu l∆∞∆°ng
          const tr = document.createElement('tr');
          tr.innerHTML = `<td colspan="4" class="uid">‚ö†Ô∏è Kh√¥ng c√≥ l∆∞∆°ng trong th√°ng n√†y.</td>`;
          tb.appendChild(tr);

          if(btn){
            btn.disabled = true;
            btn.title = 'Kh√¥ng c√≥ d·ªØ li·ªáu l∆∞∆°ng ƒë·ªÉ g·ª≠i y√™u c·∫ßu';
          }
          if(note){
            note.textContent = 'Ch∆∞a c√≥ gi·ªù ch·∫•m c√¥ng trong th√°ng ƒë∆∞·ª£c ch·ªçn.';
          }
        } else {
          if(btn){
            btn.disabled = false;
            btn.title = '';
          }
          if(note){
            note.textContent = 'L∆∞∆°ng t·∫°m t√≠nh d·ª±a tr√™n b·∫£ng ch·∫•m c√¥ng ƒë√£ ghi nh·∫≠n.';
          }
        }

        refreshHome();
      }

      function requestPayout(){
        const btn = document.getElementById('btnPayout');
        if(btn && btn.disabled){
          alert('Ch∆∞a c√≥ d·ªØ li·ªáu l∆∞∆°ng trong th√°ng n√†y.');
          return;
        }
        alert('ƒê√£ g·ª≠i y√™u c·∫ßu thanh to√°n k·ª≥ n√†y.');
      }

      // ================== PROFILE ==================
      function loadProfile() {
        const p = state.profile || {};
        // G√°n l·∫°i d·ªØ li·ªáu form
        pfName.value = p.name || '';
        pfEmail.value = p.email || '';
        pfPhone.value = p.phone || '';
        pfMajor.value = p.major || '';
        pfLevel.value = p.level || '';
        pfBio.value = p.bio || '';

        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã ·ªü ph·∫ßn ch√†o
        document.getElementById('helloName').textContent = p.name || 'Gia s∆∞';
        document.getElementById('tutorName2').textContent = p.name || 'Gia s∆∞';
        document.getElementById('avatar').textContent = initials(p.name);
        document.getElementById('avatar2').textContent = initials(p.name);

        // C·∫≠p nh·∫≠t ph·∫ßn h·ªì s∆° c√¥ng khai
        document.getElementById('pubName').textContent = p.name?.trim() || '‚Äî';
        document.getElementById('pubMajor').textContent = p.major?.trim() || '‚Äî';
        document.getElementById('pubLevel').textContent = p.level?.trim() || '‚Äî';
        document.getElementById('pubBio').textContent = p.bio?.trim() || '‚Äî';
      }

      function saveProfile(){
        state.profile = { 
          name: pfName.value, 
          email: pfEmail.value, 
          phone: pfPhone.value, 
          major: pfMajor.value, 
          level: pfLevel.value,
          bio: pfBio.value 
        };
        save(); loadProfile(); alert('ƒê√£ l∆∞u h·ªì s∆°.');
    }

    // ================== REQUESTS ==================
    function fillRqCourses(){
      // const sel = document.getElementById('rqCourse'); sel.innerHTML='';
      // state.teaching.forEach(c=>{ const op=document.createElement('option'); op.value=c.id; op.textContent=c.name; sel.appendChild(op); });
    }
    function submitRequest(){
      const r = { type: rqType.value, courseId: rqCourse.value, from: rqFrom.value, to: rqTo.value, reason: rqReason.value, ts: Date.now(), status: 'waiting' };
      state.requests.unshift(r); save(); renderRequests(); clearRequestForm(); alert('ƒê√£ g·ª≠i ƒë∆°n. Vui l√≤ng ƒë·ª£i duy·ªát.');
    }
    function clearRequestForm(){ rqReason.value=''; rqFrom.value=''; rqTo.value=''; }
    function renderRequests(){
      const box = document.getElementById('rqList'); box.innerHTML='';
      const label = t => t==='change'?'ƒê·ªïi l·ªãch':(t==='leave'?'Ngh·ªâ t·∫°m th·ªùi':'Ngh·ªâ vi·ªác');
      state.requests.forEach((r,i)=>{
        // const c = state.teaching.find(x=>x.id===r.courseId);
        const row = document.createElement('div'); row.className='file-item';
        row.innerHTML = `<div>
            <div><strong>${label(r.type)}</strong> <span class="tag wait">ƒêang ch·ªù duy·ªát</span></div>
            <div class="uid">${r.courseId} ‚Ä¢ ${r.from||'‚Äî'} ‚Üí ${r.to||'‚Äî'} ‚Ä¢ ${new Date(r.ts).toLocaleString()}</div>
            <div class="uid">L√Ω do: ${r.reason||'‚Äî'}</div>
          </div>
          <button class="btn btn-ghost mini" onclick="delRequest(${i})">X√≥a</button>`;
        box.appendChild(row);
      });
    }
    function delRequest(i){ state.requests.splice(i,1); save(); renderRequests(); }



    // ================== SCHEDULE ==================
    function renderSchedule() {
      const tb = document.querySelector('#tblSchedule tbody');
      if (!tb) return;
      tb.innerHTML = '';

      state.schedule.forEach((s, index) => {
        const tr = document.createElement('tr');
        // const c = state.teaching.find(x => x.id === s.courseId);

        // Ki·ªÉm tra tr·∫°ng th√°i ho√†n th√†nh (m·∫∑c ƒë·ªãnh l√† false n·∫øu ch∆∞a c√≥)
        if (s.completed === undefined) {
          s.completed = false;
        }

        const btnText = s.completed ? 'Ho√†n th√†nh' : 'Ch∆∞a ho√†n th√†nh';
        const btnClass = s.completed ? 'btn btn-success mini' : 'btn btn-ghost mini';

        tr.innerHTML = `
          <td>${s.date}</td>
          <td>${s.time}</td>
          <td>${s.courseId}</td>
          <td>${s.note || ''}</td>
          <td><button class="${btnClass}" onclick="toggleComplete(${index})">${btnText}</button></td>
        `;
        tb.appendChild(tr);
      });

      save();
    }

    function toggleComplete(index) {
      state.schedule[index].completed = !state.schedule[index].completed;
      renderSchedule();
    }

    // ================== INIT RENDER ==================
    function bootstrap(){
      save();
      refreshHome();
      renderOpenClasses(); 
      renderSchedule();
      const payMonthEl = document.getElementById('payMonth');
      if (payMonthEl) payMonthEl.value = new Date().toISOString().slice(0,7);
      renderPayroll();
      loadProfile();
      // fillRqCourses(); 
      // renderRequests();
    }
    bootstrap();



  </script>
</body>
</html>
